!function(){var b=tinymce.DOM;tinymce.create("tinymce.plugins.WordPress",{init:function(t,s){var r,q,p,o,n,m=this,l=t.getParam("wordpress_adv_toolbar","toolbar2"),a=0;r='<img src="'+s+'/img/trans.gif" class="mce-wp-more mceItemNoResize" title="'+t.getLang("wordpress.wp_more_alt")+'" />',q='<img src="'+s+'/img/trans.gif" class="mce-wp-nextpage mceItemNoResize" title="'+t.getLang("wordpress.wp_page_alt")+'" />',"1"==getUserSetting("hidetb","0")&&(t.settings.wordpress_adv_hidden=0),t.onPostRender.add(function(){var d=t.controlManager.get(l);t.getParam("wordpress_adv_hidden",1)&&d&&(b.hide(d.id),m._resizeIframe(t,l,28))}),t.addCommand("WP_More",function(){t.execCommand("mceInsertContent",0,r)}),t.addCommand("WP_Page",function(){t.execCommand("mceInsertContent",0,q)}),t.addCommand("WP_Help",function(){t.windowManager.open({url:tinymce.baseURL+"/wp-mce-help.php",width:450,height:420,inline:1})}),t.addCommand("WP_Adv",function(){var f=t.controlManager,e=f.get(l).id;"undefined"!=e&&(b.isHidden(e)?(f.setActive("wp_adv",1),b.show(e),m._resizeIframe(t,l,-28),t.settings.wordpress_adv_hidden=0,setUserSetting("hidetb","1")):(f.setActive("wp_adv",0),b.hide(e),m._resizeIframe(t,l,28),t.settings.wordpress_adv_hidden=1,setUserSetting("hidetb","0")))}),t.addCommand("WP_Medialib",function(){"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(t.id)}),t.addButton("wp_more",{title:"wordpress.wp_more_desc",cmd:"WP_More"}),t.addButton("wp_page",{title:"wordpress.wp_page_desc",image:s+"/img/page.gif",cmd:"WP_Page"}),t.addButton("wp_help",{title:"wordpress.wp_help_desc",cmd:"WP_Help"}),t.addButton("wp_adv",{title:"wordpress.wp_adv_desc",cmd:"WP_Adv"}),t.addButton("add_media",{title:"wordpress.add_media",image:s+"/img/image.gif",cmd:"WP_Medialib"}),t.onBeforeExecCommand.add(function(E,D,C,B,A){var z,y,x,w,v,u,h=tinymce.DOM;"mceFullScreen"==D&&"mce_fullscreen"!=E.id&&h.select("a.thickbox").length&&(E.settings.theme_advanced_buttons1+=",|,add_media"),("JustifyLeft"==D||"JustifyRight"==D||"JustifyCenter"==D)&&(z=E.selection.getNode(),"IMG"==z.nodeName&&(u=D.substr(7).toLowerCase(),v="align"+u,y=E.dom.getParent(z,"dl.wp-caption"),x=E.dom.getParent(z,"div.mceTemp"),y&&x?(w=E.dom.hasClass(y,v)?"alignnone":v,y.className=y.className.replace(/align[^ '"]+\s?/g,""),E.dom.addClass(y,w),"aligncenter"==w?E.dom.addClass(x,"mceIEcenter"):E.dom.removeClass(x,"mceIEcenter"),A.terminate=!0,E.execCommand("mceRepaint")):E.dom.hasClass(z,v)?E.dom.addClass(z,"alignnone"):E.dom.removeClass(z,"alignnone"))),!tinymce.isWebKit||"InsertUnorderedList"!=D&&"InsertOrderedList"!=D||(n||(n=E.dom.create("style",{type:"text/css"},"#tinymce,#tinymce span,#tinymce li,#tinymce li>span,#tinymce p,#tinymce p>span{font:medium sans-serif;color:#000;line-height:normal;}")),E.getDoc().head.appendChild(n))}),t.onExecCommand.add(function(d,c){tinymce.isWebKit&&n&&("InsertUnorderedList"==c||"InsertOrderedList"==c)&&d.dom.remove(n)}),t.onInit.add(function(e){var d=e.getParam("body_class",""),f=e.getBody();d=d?d.split(" "):[],"rtl"==e.getParam("directionality","")&&d.push("rtl"),tinymce.isIE9?d.push("ie9"):tinymce.isIE8?d.push("ie8"):tinymce.isIE7&&d.push("ie7"),"wp_mce_fullscreen"!=e.id&&"mce_fullscreen"!=e.id?d.push("wp-editor"):"mce_fullscreen"==e.id&&d.push("mce-fullscreen"),tinymce.each(d,function(c){c&&e.dom.addClass(f,c)}),e.onNodeChange.add(function(h,g,j){var i;"IMG"==j.nodeName?i=h.dom.getParent(j,"dl.wp-caption"):"DIV"==j.nodeName&&h.dom.hasClass(j,"mceTemp")&&(i=j.firstChild,h.dom.hasClass(i,"wp-caption")||(i=!1)),i&&(h.dom.hasClass(i,"alignleft")?g.setActive("justifyleft",1):h.dom.hasClass(i,"alignright")?g.setActive("justifyright",1):h.dom.hasClass(i,"aligncenter")&&g.setActive("justifycenter",1))}),e.onBeforeSetContent.add(function(g,c){c.content&&(c.content=c.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)( [^>]*)?>/gi,"<$1$2>"),c.content=c.content.replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)>\s*<\/p>/gi,"</$1>"))})}),"undefined"!=typeof jQuery&&t.onKeyUp.add(function(e,d){var f=d.keyCode||d.charCode;f!=a&&((13==f||8==a||46==a)&&jQuery(document).triggerHandler("wpcountwords",[e.getContent({format:"raw"})]),a=f)}),t.onSaveContent.addToTop(function(d,c){c.content=c.content.replace(/<p>(<br ?\/?>|\u00a0|\uFEFF)?<\/p>/g,"<p>&nbsp;</p>")}),tinymce.isIOS5&&t.onKeyDown.add(function(){document.activeElement==document.body&&t.getWin().focus()}),t.onSaveContent.add(function(d,c){d.isHidden()?c.content=c.element.value:d.getParam("wpautop",!0)&&"object"==typeof switchEditors&&(c.content=switchEditors.pre_wpautop(c.content))}),m._handleMoreBreak(t,s),o="alt+shift",t.addShortcut(o+"+c","justifycenter_desc","JustifyCenter"),t.addShortcut(o+"+r","justifyright_desc","JustifyRight"),t.addShortcut(o+"+l","justifyleft_desc","JustifyLeft"),t.addShortcut(o+"+j","justifyfull_desc","JustifyFull"),t.addShortcut(o+"+q","blockquote_desc","mceBlockQuote"),t.addShortcut(o+"+u","bullist_desc","InsertUnorderedList"),t.addShortcut(o+"+o","numlist_desc","InsertOrderedList"),t.addShortcut(o+"+n","spellchecker.desc","mceSpellCheck"),t.addShortcut(o+"+a","link_desc","WP_Link"),t.addShortcut(o+"+s","unlink_desc","unlink"),t.addShortcut(o+"+m","image_desc","WP_Medialib"),t.addShortcut(o+"+z","wordpress.wp_adv_desc","WP_Adv"),t.addShortcut(o+"+t","wordpress.wp_more_desc","WP_More"),t.addShortcut(o+"+d","striketrough_desc","Strikethrough"),t.addShortcut(o+"+h","help_desc","WP_Help"),t.addShortcut(o+"+p","wordpress.wp_page_desc","WP_Page"),t.addShortcut("ctrl+s","save_desc",function(){"function"==typeof autosave&&autosave()}),/\bwpfullscreen\b/.test(t.settings.plugins)?t.addShortcut(o+"+w","wordpress.wp_fullscreen_desc","wpFullScreen"):/\bfullscreen\b/.test(t.settings.plugins)&&t.addShortcut(o+"+g","fullscreen.desc","mceFullScreen"),t.onInit.add(function(c){tinymce.dom.Event.add(c.getWin(),"scroll",function(){c.plugins.wordpress._hideButtons()}),tinymce.dom.Event.add(c.getBody(),"dragstart",function(){c.plugins.wordpress._hideButtons()})}),t.onBeforeExecCommand.add(function(c){c.plugins.wordpress._hideButtons()}),t.onSaveContent.add(function(c){c.plugins.wordpress._hideButtons()}),t.onMouseDown.add(function(d,c){"IMG"!=c.target.nodeName&&d.plugins.wordpress._hideButtons()}),t.onKeyDown.add(function(d,c){(c.which==tinymce.VK.DELETE||c.which==tinymce.VK.BACKSPACE)&&d.plugins.wordpress._hideButtons()}),p=function(d){var e;if("mceModalBlocker"==d.target.id||"ui-widget-overlay"==d.target.className){for(e in t.windowManager.windows){t.windowManager.close(null,e)}}},tinymce.dom.Event.remove(document.body,"click",p),tinymce.dom.Event.add(document.body,"click",p)},getInfo:function(){return{longname:"WordPress Plugin",author:"WordPress",authorurl:"http://wordpress.org",infourl:"http://wordpress.org",version:"3.0"}},_setEmbed:function(c){return c.replace(/\[embed\]([\s\S]+?)\[\/embed\][\s\u00a0]*/g,function(e,d){return'<img width="300" height="200" src="'+tinymce.baseURL+'/plugins/wordpress/img/trans.gif" class="wp-oembed mceItemNoResize" alt="'+d+'" title="'+d+'" />'})},_getEmbed:function(c){return c.replace(/<img[^>]+>/g,function(e){if(-1!=e.indexOf('class="wp-oembed')){var d=e.match(/alt="([^\"]+)"/);d[1]&&(e="[embed]"+d[1]+"[/embed]")}return e})},_showButtons:function(r,q){var p,o,n,m,l,k=tinyMCE.activeEditor,j=tinymce.DOM;n=k.dom.getViewPort(k.getWin()),p=j.getPos(k.getContentAreaContainer()),o=k.dom.getPos(r),m=Math.max(o.x-n.x,0)+p.x,l=Math.max(o.y-n.y,0)+p.y,j.setStyles(q,{top:l+5+"px",left:m+5+"px",display:"block"})},_hideButtons:function(){var c=tinymce.DOM;c.hide(c.select("#wp_editbtns, #wp_gallerybtns"))},_resizeIframe:function(a,h,g){var f=a.getContentAreaContainer().firstChild;b.setStyle(f,"height",f.clientHeight+g),a.theme.deltaHeight+=g},_handleMoreBreak:function(f,e){var h,g;h='<img src="'+e+'/img/trans.gif" alt="$1" class="mce-wp-more mceItemNoResize" title="'+f.getLang("wordpress.wp_more_alt")+'" />',g='<img src="'+e+'/img/trans.gif" class="mce-wp-nextpage mceItemNoResize" title="'+f.getLang("wordpress.wp_page_alt")+'" />',f.onPostRender.add(function(){f.theme.onResolveName&&f.theme.onResolveName.add(function(a,d){"IMG"==d.node.nodeName&&(f.dom.hasClass(d.node,"mce-wp-more")&&(d.name="wpmore"),f.dom.hasClass(d.node,"mce-wp-nextpage")&&(d.name="wppage"))})}),f.onBeforeSetContent.add(function(d,c){c.content&&(c.content=c.content.replace(/<!--more(.*?)-->/g,h),c.content=c.content.replace(/<!--nextpage-->/g,g))}),f.onPostProcess.add(function(d,c){c.get&&(c.content=c.content.replace(/<img[^>]+>/g,function(j){if(-1!==j.indexOf('class="mce-wp-more')){var i,k=(i=j.match(/alt="(.*?)"/))?i[1]:"";j="<!--more"+k+"-->"}return -1!==j.indexOf('class="mce-wp-nextpage')&&(j="<!--nextpage-->"),j}))}),f.onNodeChange.add(function(i,d,j){d.setActive("wp_page","IMG"===j.nodeName&&i.dom.hasClass(j,"mce-wp-nextpage")),d.setActive("wp_more","IMG"===j.nodeName&&i.dom.hasClass(j,"mce-wp-more"))})}}),tinymce.PluginManager.add("wordpress",tinymce.plugins.WordPress)}();