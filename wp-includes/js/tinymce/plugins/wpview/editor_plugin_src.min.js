(function(){var c=tinymce.VK,a=tinymce.dom.TreeWalker,b;tinymce.create("tinymce.plugins.wpView",{init:function(e){var d=this;if(typeof wp==="undefined"||!wp.mce){return}e.onPreInit.add(function(f){f.schema.addValidElements("div[*],span[*]")});e.onBeforeSetContent.add(function(f,g){if(!g.content){return}g.content=wp.mce.view.toViews(g.content)});e.onSetContent.add(function(f){wp.mce.view.render(f.getDoc())});e.onInit.add(function(f){f.selection.onBeforeSetContent.add(function(h){var g=d.getParentView(h.getNode()),j,i;if(!g){return}if(!g.nextSibling||d.isView(g.nextSibling)){i=f.getDoc().createTextNode("");f.dom.insertAfter(i,g)}else{j=new a(g.nextSibling,g.nextSibling);i=j.next()}h.select(i);h.collapse(true)});f.selection.onSetContent.add(function(g,i){if(!i.context){return}var h=g.getNode();if(!h.innerHTML){return}h.innerHTML=wp.mce.view.toViews(h.innerHTML);wp.mce.view.render(h)})});e.onPostProcess.add(function(f,g){if((!g.get&&!g.save)||!g.content){return}g.content=wp.mce.view.toText(g.content)});e.onNodeChange.addToTop(function(h,f,i){var g=d.getParentView(i);if(g){d.select(g);return false}else{d.deselect()}});e.onKeyDown.addToTop(function(h,i){var j=i.keyCode,g,f;if(!b){return}g=d.getParentView(h.selection.getNode());if(g!==b){d.deselect();return}if(j===c.DELETE||j===c.BACKSPACE){if((f=wp.mce.view.instance(b))){f.remove();d.deselect()}}if(i.metaKey||i.ctrlKey||(j>=112&&j<=123)){return}i.preventDefault()})},getParentView:function(d){while(d){if(this.isView(d)){return d}d=d.parentNode}},isView:function(d){return(/(?:^|\s)wp-view-wrap(?:\s|$)/).test(d.className)},select:function(d){if(d===b){return}this.deselect();b=d;wp.mce.view.select(b)},deselect:function(){if(b){wp.mce.view.deselect(b)}b=null},getInfo:function(){return{longname:"WordPress Views",author:"WordPress",authorurl:"http://wordpress.org",infourl:"http://wordpress.org",version:"1.0"}}});tinymce.PluginManager.add("wpview",tinymce.plugins.wpView)})();