(function(v,t,u,y){var B={},w;function C(c){var d=c.naturalWidth,a=c.naturalHeight;if(d*a>1024*1024){var b=t.createElement("canvas");b.width=b.height=1;var e=b.getContext("2d");e.drawImage(c,-d+1,0);return e.getImageData(0,0,1,1).data[3]===0}else{return false}}function z(j,a,d){var b=t.createElement("canvas");b.width=1;b.height=d;var c=b.getContext("2d");c.drawImage(j,0,0);var k=c.getImageData(0,0,1,d).data;var f=0;var h=d;var e=d;while(e>f){var l=k[(e-1)*4+3];if(l===0){h=e}else{f=e}e=(h+f)>>1}var g=(e/d);return(g===0)?1:g}function r(a,p,o){var k=a.naturalWidth,b=a.naturalHeight;var n=o.width,O=o.height;var l=p.getContext("2d");l.save();var N=C(a);if(N){k/=2;b/=2}var f=1024;var P=t.createElement("canvas");P.width=P.height=f;var m=P.getContext("2d");var j=z(a,k,b);var Q=0;while(Q<b){var d=Q+f>b?b-Q:f;var M=0;while(M<k){var L=M+f>k?k-M:f;m.clearRect(0,0,f,f);m.drawImage(a,-M,-Q);var e=(M*n/k)<<0;var c=Math.ceil(L*n/k);var h=(Q*O/b/j)<<0;var g=Math.ceil(d*O/b/j);l.drawImage(P,0,0,L,d,e,h,c,g);M+=f}Q+=f}l.restore();P=m=null}function q(b,a){var c;if("FileReader" in v){c=new FileReader();c.readAsDataURL(b);c.onload=function(){a(c.result)}}else{return a(b.getAsDataURL())}}function s(b,a){var c;if("FileReader" in v){c=new FileReader();c.readAsBinaryString(b);c.onload=function(){a(c.result)}}else{return a(b.getAsBinary())}}function A(g,j,b,c){var h,a,d,f,e=this;q(B[g.id],function(k){h=t.createElement("canvas");h.style.display="none";t.body.appendChild(h);d=new Image();d.onerror=d.onabort=function(){c({success:false})};d.onload=function(){var m,l,p,G,n;if(!j.width){j.width=d.width}if(!j.height){j.height=d.height}f=Math.min(j.width/d.width,j.height/d.height);if(f<1){m=Math.round(d.width*f);l=Math.round(d.height*f)}else{if(j.quality&&b==="image/jpeg"){m=d.width;l=d.height}else{c({success:false});return}}h.width=m;h.height=l;r(d,h,{width:m,height:l});if(b==="image/jpeg"){G=new x(atob(k.substring(k.indexOf("base64,")+7)));if(G.headers&&G.headers.length){n=new E();if(n.init(G.get("exif")[0])){n.setExif("PixelXDimension",m);n.setExif("PixelYDimension",l);G.set("exif",n.getBinary());if(e.hasEventListener("ExifData")){e.trigger("ExifData",g,n.EXIF())}if(e.hasEventListener("GpsData")){e.trigger("GpsData",g,n.GPS())}}}}if(j.quality&&b==="image/jpeg"){try{k=h.toDataURL(b,j.quality/100)}catch(o){k=h.toDataURL(b)}}else{k=h.toDataURL(b)}k=k.substring(k.indexOf("base64,")+7);k=atob(k);if(G&&G.headers&&G.headers.length){k=G.restore(k);G.purge()}h.parentNode.removeChild(h);c({success:true,data:k})};d.src=k})}u.runtimes.Html5=u.addRuntime("html5",{getFeatures:function(){var a,e,b,c,d,f;e=b=d=f=false;if(v.XMLHttpRequest){a=new XMLHttpRequest();b=!!a.upload;e=!!(a.sendAsBinary||a.upload)}if(e){c=!!(a.sendAsBinary||(v.Uint8Array&&v.ArrayBuffer));d=!!(File&&(File.prototype.getAsDataURL||v.FileReader)&&c);f=!!(File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))}w=u.ua.safari&&u.ua.windows;return{html5:e,dragdrop:(function(){var g=t.createElement("div");return("draggable" in g)||("ondragstart" in g&&"ondrop" in g)}()),jpgresize:d,pngresize:d,multipart:d||!!v.FileReader||!!v.FormData,canSendBinary:c,cantSendBlobInFormData:!!(u.ua.gecko&&v.FormData&&v.FileReader&&!FileReader.prototype.readAsArrayBuffer)||u.ua.android,progress:b,chunks:f,multi_selection:!(u.ua.safari&&u.ua.windows),triggerDialog:(u.ua.gecko&&v.FormData||u.ua.webkit)}},init:function(c,a){var e,b;function d(k){var g,h,l=[],f,j={};for(h=0;h<k.length;h++){g=k[h];if(j[g.name]&&u.ua.safari&&u.ua.windows){continue}j[g.name]=true;f=u.guid();B[f]=g;l.push(new u.File(f,g.fileName||g.name,g.fileSize||g.size))}if(l.length){c.trigger("FilesAdded",l)}}e=this.getFeatures();if(!e.html5){a({success:false});return}c.bind("Init",function(j){var l,n,M=[],k,L,o=j.settings.filters,m,N,K=t.body,p;l=t.createElement("div");l.id=j.id+"_html5_container";u.extend(l.style,{position:"absolute",background:c.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:c.settings.shim_bgcolor?"":0});l.className="plupload html5";if(c.settings.container){K=t.getElementById(c.settings.container);if(u.getStyle(K,"position")==="static"){K.style.position="relative"}}K.appendChild(l);no_type_restriction:for(k=0;k<o.length;k++){m=o[k].extensions.split(/,/);for(L=0;L<m.length;L++){if(m[L]==="*"){M=[];break no_type_restriction}N=u.mimeTypes[m[L]];if(N&&u.inArray(N,M)===-1){M.push(N)}}}l.innerHTML='<input id="'+c.id+'_html5"  style="font-size:999px" type="file" accept="'+M.join(",")+'" '+(c.settings.multi_selection&&c.features.multi_selection?'multiple="multiple"':"")+" />";l.scrollTop=100;p=t.getElementById(c.id+"_html5");if(j.features.triggerDialog){u.extend(p.style,{position:"absolute",width:"100%",height:"100%"})}else{u.extend(p.style,{cssFloat:"right",styleFloat:"right"})}p.onchange=function(){d(this.files);this.value=""};n=t.getElementById(j.settings.browse_button);if(n){var g=j.settings.browse_button_hover,f=j.settings.browse_button_active,h=j.features.triggerDialog?n:l;if(g){u.addEvent(h,"mouseover",function(){u.addClass(n,g)},j.id);u.addEvent(h,"mouseout",function(){u.removeClass(n,g)},j.id)}if(f){u.addEvent(h,"mousedown",function(){u.addClass(n,f)},j.id);u.addEvent(t.body,"mouseup",function(){u.removeClass(n,f)},j.id)}if(j.features.triggerDialog){u.addEvent(n,"click",function(F){var G=t.getElementById(j.id+"_html5");if(G&&!G.disabled){G.click()}F.preventDefault()},j.id)}}});c.bind("PostInit",function(){var f=t.getElementById(c.settings.drop_element);if(f){if(w){u.addEvent(f,"dragenter",function(j){var k,h,g;k=t.getElementById(c.id+"_drop");if(!k){k=t.createElement("input");k.setAttribute("type","file");k.setAttribute("id",c.id+"_drop");k.setAttribute("multiple","multiple");u.addEvent(k,"change",function(){d(this.files);u.removeEvent(k,"change",c.id);k.parentNode.removeChild(k)},c.id);u.addEvent(k,"dragover",function(l){l.stopPropagation()},c.id);f.appendChild(k)}h=u.getPos(f,t.getElementById(c.settings.container));g=u.getSize(f);if(u.getStyle(f,"position")==="static"){u.extend(f.style,{position:"relative"})}u.extend(k.style,{position:"absolute",display:"block",top:0,left:0,width:g.w+"px",height:g.h+"px",opacity:0})},c.id);return}u.addEvent(f,"dragover",function(g){g.preventDefault()},c.id);u.addEvent(f,"drop",function(g){var h=g.dataTransfer;if(h&&h.files){d(h.files)}g.preventDefault()},c.id)}});c.bind("Refresh",function(j){var h,g,l,f,k;h=t.getElementById(c.settings.browse_button);if(h){g=u.getPos(h,t.getElementById(j.settings.container));l=u.getSize(h);f=t.getElementById(c.id+"_html5_container");u.extend(f.style,{top:g.y+"px",left:g.x+"px",width:l.w+"px",height:l.h+"px"});if(c.features.triggerDialog){if(u.getStyle(h,"position")==="static"){u.extend(h.style,{position:"relative"})}k=parseInt(u.getStyle(h,"zIndex"),10);if(isNaN(k)){k=0}u.extend(h.style,{zIndex:k});u.extend(f.style,{zIndex:k-1})}}});c.bind("DisableBrowse",function(h,f){var g=t.getElementById(h.id+"_html5");if(g){g.disabled=f}});c.bind("CancelUpload",function(){if(b&&b.abort){b.abort()}});c.bind("UploadFile",function(j,g){var m=j.settings,l,h;function f(H,n,I){var p;if(File.prototype.slice){try{H.slice();return H.slice(n,I)}catch(o){return H.slice(n,I-n)}}else{if(p=File.prototype.webkitSlice||File.prototype.mozSlice){return p.call(H,n,I)}else{return null}}}function k(G){var n=0,o=0;function p(){var T,F,R,Q,U,S,X,Y=j.settings.url;function V(H){if(b.sendAsBinary){b.sendAsBinary(H)}else{if(j.features.canSendBinary){var J=new Uint8Array(H.length);for(var I=0;I<H.length;I++){J[I]=(H.charCodeAt(I)&255)}b.send(J.buffer)}}}function W(M){var I=0,H="----pluploadboundary"+u.guid(),K,L="--",J="\r\n",N="";b=new XMLHttpRequest;if(b.upload){b.upload.onprogress=function(O){g.loaded=Math.min(g.size,o+O.loaded-I);j.trigger("UploadProgress",g)}}b.onreadystatechange=function(){var aa,O;if(b.readyState==4&&j.state!==u.STOPPED){try{aa=b.status}catch(P){aa=0}if(aa>=400){j.trigger("Error",{code:u.HTTP_ERROR,message:u.translate("HTTP Error."),file:g,status:aa})}else{if(R){O={chunk:n,chunks:R,response:b.responseText,status:aa};j.trigger("ChunkUploaded",g,O);o+=S;if(O.cancelled){g.status=u.FAILED;return}g.loaded=Math.min(g.size,(n+1)*U)}else{g.loaded=g.size}j.trigger("UploadProgress",g);M=T=K=N=null;if(!R||++n>=R){g.status=u.DONE;j.trigger("FileUploaded",g,{response:b.responseText,status:aa})}else{p()}}}};if(j.settings.multipart&&e.multipart){Q.name=g.target_name||g.name;b.open("post",Y,true);u.each(j.settings.headers,function(O,P){b.setRequestHeader(P,O)});if(typeof(M)!=="string"&&!!v.FormData){K=new FormData();u.each(u.extend(Q,j.settings.multipart_params),function(O,P){K.append(P,O)});K.append(j.settings.file_data_name,M);b.send(K);return}if(typeof(M)==="string"){b.setRequestHeader("Content-Type","multipart/form-data; boundary="+H);u.each(u.extend(Q,j.settings.multipart_params),function(O,P){N+=L+H+J+'Content-Disposition: form-data; name="'+P+'"'+J+J;N+=unescape(encodeURIComponent(O))+J});X=u.mimeTypes[g.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";N+=L+H+J+'Content-Disposition: form-data; name="'+j.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(g.name))+'"'+J+"Content-Type: "+X+J+J+M+J+L+H+L+J;I=N.length-M.length;M=N;V(M);return}}Y=u.buildUrl(j.settings.url,u.extend(Q,j.settings.multipart_params));b.open("post",Y,true);b.setRequestHeader("Content-Type","application/octet-stream");u.each(j.settings.headers,function(O,P){b.setRequestHeader(P,O)});if(typeof(M)==="string"){V(M)}else{b.send(M)}}if(g.status==u.DONE||g.status==u.FAILED||j.state==u.STOPPED){return}Q={name:g.target_name||g.name};if(m.chunk_size&&g.size>m.chunk_size&&(e.chunks||typeof(G)=="string")){U=m.chunk_size;R=Math.ceil(g.size/U);S=Math.min(U,g.size-(n*U));if(typeof(G)=="string"){T=G.substring(n*U,n*U+S)}else{T=f(G,n*U,n*U+S)}Q.chunk=n;Q.chunks=R}else{S=g.size;T=G}if(j.settings.multipart&&e.multipart&&typeof(T)!=="string"&&v.FileReader&&e.cantSendBlobInFormData&&e.chunks&&j.settings.chunk_size){(function(){var H=new FileReader();H.onload=function(){W(H.result);H=null};H.readAsBinaryString(T)}())}else{W(T)}}p()}l=B[g.id];if(e.jpgresize&&j.settings.resize&&/\.(png|jpg|jpeg)$/i.test(g.name)){A.call(j,g,j.settings.resize,/\.png$/i.test(g.name)?"image/png":"image/jpeg",function(n){if(n.success){g.size=n.data.length;k(n.data)}else{if(e.chunks){k(l)}else{s(l,k)}}})}else{if(!e.chunks&&e.jpgresize){s(l,k)}else{k(l)}}});c.bind("Destroy",function(h){var f,k,g=t.body,j={inputContainer:h.id+"_html5_container",inputFile:h.id+"_html5",browseButton:h.settings.browse_button,dropElm:h.settings.drop_element};for(f in j){k=t.getElementById(j[f]);if(k){u.removeAllEvents(k,h.id)}}u.removeAllEvents(t.body,h.id);if(h.settings.container){g=t.getElementById(h.settings.container)}g.removeChild(t.getElementById(j.inputContainer))});a({success:true})}});function D(){var b=false,d;function a(g,k){var h=b?0:-8*(k-1),j=0,f;for(f=0;f<k;f++){j|=(d.charCodeAt(g+f)<<Math.abs(h+f*8))}return j}function e(f,h,g){var g=arguments.length===3?g:d.length-h-1;d=d.substr(0,h)+f+d.substr(g+h)}function c(h,g,k){var f="",j=b?0:-8*(k-1),l;for(l=0;l<k;l++){f+=String.fromCharCode((g>>Math.abs(j+l*8))&255)}e(f,h,k)}return{II:function(f){if(f===y){return b}else{b=f}},init:function(f){b=false;d=f},SEGMENT:function(h,f,g){switch(arguments.length){case 1:return d.substr(h,d.length-h-1);case 2:return d.substr(h,f);case 3:e(g,h,f);break;default:return d}},BYTE:function(f){return a(f,1)},SHORT:function(f){return a(f,2)},LONG:function(g,f){if(f===y){return a(g,4)}else{c(g,f,4)}},SLONG:function(g){var f=a(g,4);return(f>2147483647?f-4294967296:f)},STRING:function(h,g){var f="";for(g+=h;h<g;h++){f+=String.fromCharCode(a(h,1))}return f}}}function x(c){var a={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},b=[],d,h,f=y,e=0,g;d=new D();d.init(c);if(d.SHORT(0)!==65496){return}h=2;g=Math.min(1048576,c.length);while(h<=g){f=d.SHORT(h);if(f>=65488&&f<=65495){h+=2;continue}if(f===65498||f===65497){break}e=d.SHORT(h+2)+2;if(a[f]&&d.STRING(h+4,a[f].signature.length)===a[f].signature){b.push({hex:f,app:a[f].app.toUpperCase(),name:a[f].name.toUpperCase(),start:h,length:e,segment:d.SEGMENT(h,e)})}h+=e}d.init(null);return{headers:b,restore:function(n){d.init(n);var l=new x(n);if(!l.headers){return false}for(var j=l.headers.length;j>0;j--){var k=l.headers[j-1];d.SEGMENT(k.start,k.length,"")}l.purge();h=d.SHORT(2)==65504?4+d.SHORT(4):2;for(var j=0,m=b.length;j<m;j++){d.SEGMENT(h,0,b[j].segment);h+=b[j].length}return d.SEGMENT()},get:function(j){var m=[];for(var k=0,l=b.length;k<l;k++){if(b[k].app===j.toUpperCase()){m.push(b[k].segment)}}return m},set:function(n,j){var l=[];if(typeof(j)==="string"){l.push(j)}else{l=j}for(var k=ii=0,m=b.length;k<m;k++){if(b[k].app===n.toUpperCase()){b[k].segment=l[ii];b[k].length=l[ii].length;ii++}if(ii>=l.length){break}}},purge:function(){b=[];d.init(null)}}}function E(){var d,g,f={},a;d=new D();g={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};a={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};function e(p,N){var m=d.SHORT(p),j,K,o,O,h,n,l,M,L=[],k={};for(j=0;j<m;j++){l=n=p+12*j+2;o=N[d.SHORT(l)];if(o===y){continue}O=d.SHORT(l+=2);h=d.LONG(l+=2);l+=4;L=[];switch(O){case 1:case 7:if(h>4){l=d.LONG(l)+f.tiffHeader}for(K=0;K<h;K++){L[K]=d.BYTE(l+K)}break;case 2:if(h>4){l=d.LONG(l)+f.tiffHeader}k[o]=d.STRING(l,h-1);continue;case 3:if(h>2){l=d.LONG(l)+f.tiffHeader}for(K=0;K<h;K++){L[K]=d.SHORT(l+K*2)}break;case 4:if(h>1){l=d.LONG(l)+f.tiffHeader}for(K=0;K<h;K++){L[K]=d.LONG(l+K*4)}break;case 5:l=d.LONG(l)+f.tiffHeader;for(K=0;K<h;K++){L[K]=d.LONG(l+K*4)/d.LONG(l+K*4+4)}break;case 9:l=d.LONG(l)+f.tiffHeader;for(K=0;K<h;K++){L[K]=d.SLONG(l+K*4)}break;case 10:l=d.LONG(l)+f.tiffHeader;for(K=0;K<h;K++){L[K]=d.SLONG(l+K*4)/d.SLONG(l+K*4+4)}break;default:continue}M=(h==1?L[0]:L);if(a.hasOwnProperty(o)&&typeof M!="object"){k[o]=a[o][M]}else{k[o]=M}}return k}function b(){var j=y,h=f.tiffHeader;d.II(d.SHORT(h)==18761);if(d.SHORT(h+=2)!==42){return false}f.IFD0=f.tiffHeader+d.LONG(h+=2);j=e(f.IFD0,g.tiff);f.exifIFD=("ExifIFDPointer" in j?f.tiffHeader+j.ExifIFDPointer:y);f.gpsIFD=("GPSInfoIFDPointer" in j?f.tiffHeader+j.GPSInfoIFDPointer:y);return true}function c(n,j,m){var k,p,h,l=0;if(typeof(j)==="string"){var o=g[n.toLowerCase()];for(hex in o){if(o[hex]===j){j=hex;break}}}k=f[n.toLowerCase()+"IFD"];p=d.SHORT(k);for(i=0;i<p;i++){h=k+12*i+2;if(d.SHORT(h)==j){l=h+8;break}}if(!l){return false}d.LONG(l,m);return true}return{init:function(h){f={tiffHeader:10};if(h===y||!h.length){return false}d.init(h);if(d.SHORT(0)===65505&&d.STRING(4,5).toUpperCase()==="EXIF\0"){return b()}return false},EXIF:function(){var k;k=e(f.exifIFD,g.exif);if(k.ExifVersion&&u.typeOf(k.ExifVersion)==="array"){for(var j=0,h="";j<k.ExifVersion.length;j++){h+=String.fromCharCode(k.ExifVersion[j])}k.ExifVersion=h}return k},GPS:function(){var h;h=e(f.gpsIFD,g.gps);if(h.GPSVersionID){h.GPSVersionID=h.GPSVersionID.join(".")}return h},setExif:function(h,j){if(h!=="PixelXDimension"&&h!=="PixelYDimension"){return false}return c("exif",h,j)},getBinary:function(){return d.SEGMENT()}}}})(window,document,plupload);