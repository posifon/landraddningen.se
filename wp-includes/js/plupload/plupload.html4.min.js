(function(i,g,f,j){function h(a){return g.getElementById(a)}f.runtimes.Html4=f.addRuntime("html4",{getFeatures:function(){return{multipart:true,triggerDialog:(f.ua.gecko&&i.FormData||f.ua.webkit)}},init:function(b,a){b.bind("Init",function(e){var E=g.body,A,F="javascript",D,H,d,G=[],c=/MSIE/.test(navigator.userAgent),L=[],B=e.settings.filters,y,C,M,I;no_type_restriction:for(y=0;y<B.length;y++){C=B[y].extensions.split(/,/);for(I=0;I<C.length;I++){if(C[I]==="*"){L=[];break no_type_restriction}M=f.mimeTypes[C[I]];if(M&&f.inArray(M,L)===-1){L.push(M)}}}L=L.join(",");function J(){var n,m,l,k;d=f.guid();G.push(d);n=g.createElement("form");n.setAttribute("id","form_"+d);n.setAttribute("method","post");n.setAttribute("enctype","multipart/form-data");n.setAttribute("encoding","multipart/form-data");n.setAttribute("target",e.id+"_iframe");n.style.position="absolute";m=g.createElement("input");m.setAttribute("id","input_"+d);m.setAttribute("type","file");m.setAttribute("accept",L);m.setAttribute("size",1);k=h(e.settings.browse_button);if(e.features.triggerDialog&&k){f.addEvent(h(e.settings.browse_button),"click",function(o){if(!m.disabled){m.click()}o.preventDefault()},e.id)}f.extend(m.style,{width:"100%",height:"100%",opacity:0,fontSize:"99px",cursor:"pointer"});f.extend(n.style,{overflow:"hidden"});l=e.settings.shim_bgcolor;if(l){n.style.background=l}if(c){f.extend(m.style,{filter:"alpha(opacity=0)"})}f.addEvent(m,"change",function(p){var r=p.target,s,q=[],o;if(r.value){h("form_"+d).style.top=-1048575+"px";s=r.value.replace(/\\/g,"/");s=s.substring(s.length,s.lastIndexOf("/")+1);q.push(new f.File(d,s));if(!e.features.triggerDialog){f.removeAllEvents(n,e.id)}else{f.removeEvent(k,"click",e.id)}f.removeEvent(m,"change",e.id);J();if(q.length){b.trigger("FilesAdded",q)}}},e.id);n.appendChild(m);E.appendChild(n);e.refresh()}function K(){var k=g.createElement("div");k.innerHTML='<iframe id="'+e.id+'_iframe" name="'+e.id+'_iframe" src="'+F+':&quot;&quot;" style="display:none"></iframe>';A=k.firstChild;E.appendChild(A);f.addEvent(A,"load",function(n){var m=n.target,p,o;if(!D){return}try{p=m.contentWindow.document||m.contentDocument||i.frames[m.id].document}catch(l){e.trigger("Error",{code:f.SECURITY_ERROR,message:f.translate("Security error."),file:D});return}o=p.documentElement.innerText||p.documentElement.textContent;if(o){D.status=f.DONE;D.loaded=1025;D.percent=100;e.trigger("UploadProgress",D);e.trigger("FileUploaded",D,{response:o})}},e.id)}if(e.settings.container){E=h(e.settings.container);if(f.getStyle(E,"position")==="static"){E.style.position="relative"}}e.bind("UploadFile",function(l,k){var n,m;if(k.status==f.DONE||k.status==f.FAILED||l.state==f.STOPPED){return}n=h("form_"+k.id);m=h("input_"+k.id);m.setAttribute("name",l.settings.file_data_name);n.setAttribute("action",l.settings.url);f.each(f.extend({name:k.target_name||k.name},l.settings.multipart_params),function(o,q){var p=g.createElement("input");f.extend(p,{type:"hidden",name:q,value:o});n.insertBefore(p,n.firstChild)});D=k;h("form_"+d).style.top=-1048575+"px";n.submit()});e.bind("FileUploaded",function(k){k.refresh()});e.bind("StateChanged",function(k){if(k.state==f.STARTED){K()}else{if(k.state==f.STOPPED){i.setTimeout(function(){f.removeEvent(A,"load",k.id);if(A.parentNode){A.parentNode.removeChild(A)}},0)}}f.each(k.files,function(l,n){if(l.status===f.DONE||l.status===f.FAILED){var m=h("form_"+l.id);if(m){m.parentNode.removeChild(m)}}})});e.bind("Refresh",function(p){var s,n,m,l,o,r,q,t,k;s=h(p.settings.browse_button);if(s){o=f.getPos(s,h(p.settings.container));r=f.getSize(s);q=h("form_"+d);t=h("input_"+d);f.extend(q.style,{top:o.y+"px",left:o.x+"px",width:r.w+"px",height:r.h+"px"});if(p.features.triggerDialog){if(f.getStyle(s,"position")==="static"){f.extend(s.style,{position:"relative"})}k=parseInt(s.style.zIndex,10);if(isNaN(k)){k=0}f.extend(s.style,{zIndex:k});f.extend(q.style,{zIndex:k-1})}m=p.settings.browse_button_hover;l=p.settings.browse_button_active;n=p.features.triggerDialog?s:q;if(m){f.addEvent(n,"mouseover",function(){f.addClass(s,m)},p.id);f.addEvent(n,"mouseout",function(){f.removeClass(s,m)},p.id)}if(l){f.addEvent(n,"mousedown",function(){f.addClass(s,l)},p.id);f.addEvent(g.body,"mouseup",function(){f.removeClass(s,l)},p.id)}}});b.bind("FilesRemoved",function(n,m){var k,l;for(k=0;k<m.length;k++){l=h("form_"+m[k].id);if(l){l.parentNode.removeChild(l)}}});b.bind("DisableBrowse",function(l,k){var m=g.getElementById("input_"+d);if(m){m.disabled=k}});b.bind("Destroy",function(l){var o,k,n,m={inputContainer:"form_"+d,inputFile:"input_"+d,browseButton:l.settings.browse_button};for(o in m){k=h(m[o]);if(k){f.removeAllEvents(k,l.id)}}f.removeAllEvents(g.body,l.id);f.each(G,function(p,q){n=h("form_"+p);if(n){n.parentNode.removeChild(n)}})});J()});a({success:true})}})})(window,document,plupload);